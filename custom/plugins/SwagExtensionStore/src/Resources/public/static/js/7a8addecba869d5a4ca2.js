(window["webpackJsonpPluginswag-extension-store"]=window["webpackJsonpPluginswag-extension-store"]||[]).push([[710],{2827:function(){},9710:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}}),s(6510);var n=Shopware.Component.wrapComponentConfig({template:'{% block sw_in_app_purchase_checkout_modal %}\n<sw-modal\n    v-if="store.entry"\n    class="sw-in-app-purchase-checkout"\n    :title="$tc(\'sw-in-app-purchase-checkout.modalTitle\')"\n    @modal-close="handleStateActions(false)"\n>\n    <template v-if="state === \'purchase\'" #modal-title>\n        <sw-extension-icon\n            class="sw-in-app-purchase-checkout__icon"\n            :src="extensionIcon"\n        />\n\n        <div class="sw-in-app-purchase-checkout__titles">\n            <h4 id="modalTitleEl" class="sw-modal__title">\n                {{ $tc(\'sw-in-app-purchase-checkout.modalTitle\') }}\n            </h4>\n\n            <h5 class="sw-modal__subtitle">\n                {{ extension.label }}\n            </h5>\n        </div>\n    </template>\n\n    <sw-in-app-purchase-checkout-overview\n        v-if="state === \'purchase\'"\n        v-model:tos-accepted="tosAccepted"\n        :purchase="purchase"\n        :price-model="priceModel"\n    />\n\n    <sw-in-app-purchase-checkout-state\n        v-if="[\'loading\', \'success\', \'error\'].includes(state)"\n        :state="state"\n        :error-snippet="errorSnippet"\n    />\n\n    <template #modal-footer>\n        <sw-in-app-purchase-checkout-button\n            :state="state"\n            :tos-accepted="tosAccepted"\n            @click="handleStateActions(true)"\n        />\n    </template>\n</sw-modal>\n{% endblock %}\n',inject:["inAppPurchasesService"],mixins:[Shopware.Mixin.getByName("notification")],data(){return{state:"loading",store:Shopware.Store.get("inAppPurchaseCheckout"),inAppPurchaseCart:null,extension:null,tosAccepted:!1,errorSnippet:null}},created(){this.createdComponent()},computed:{priceModel(){return this.inAppPurchaseCart?.positions?.[0].feature.priceModel||null},purchase(){return this.inAppPurchaseCart?.positions?.[0].feature||null},assetFilter(){return Shopware.Filter.getByName("asset")},extensionIcon(){return this.extension?.icon?this.extension.icon:this.extension?.iconRaw?`data:image/png;base64, ${this.extension.iconRaw}`:this.assetFilter("administration/static/img/theme/default_theme_preview.jpg")},storeExtension(){let e=this.store.extension;return(Shopware.Utils.types.isObject(e)?e?.name:e)??""}},methods:{createdComponent(){this.store.$subscribe(()=>{this.requestFeature()})},async requestFeature(){if(!this.store.extension||!this.store.entry){this.reset();return}this.state="loading",await Promise.all([this.cart=this.inAppPurchasesService.createCart(this.storeExtension,this.store.entry.identifier),this.inAppPurchasesService.getExtension(this.storeExtension)]).then(([e,t])=>{this.inAppPurchaseCart=e,this.extension=t,this.state="purchase"}).catch(e=>{Shopware.Utils.debug.error(e),this.state="error"})},onPurchaseFeature(){if(!this.store.extension||!this.store.entry){this.reset();return}this.inAppPurchasesService.orderCart(this.inAppPurchaseCart?.taxRate,this.inAppPurchaseCart?.positions,this.extension?.name).then(()=>{this.state="success"}).catch(e=>{Shopware.Utils.debug.error(e),this.state="error"})},handleStateActions(e){switch(this.state){case"purchase":e?this.onPurchaseFeature():this.reset();break;case"error":e?this.requestFeature():this.reset();break;case"success":this.reset(),this.inAppPurchasesService.refreshInAppPurchases().then(()=>{window.location.reload()});break;default:this.reset()}},reset(){this.store.dismiss(),this.inAppPurchaseCart=null,this.extension=null,this.errorSnippet=null,this.state="loading"}}})},6510:function(e,t,s){var n=s(2827);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,s(534).A)("b944e9dc",n,!0,{})},534:function(e,t,s){"use strict";function n(e,t){for(var s=[],n={},r=0;r<t.length;r++){var i=t[r],a=i[0],o={id:e+":"+r,css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(o):s.push(n[a]={id:a,parts:[o]})}return s}s.d(t,{A:function(){return m}});var r,i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var a={},o=i&&(document.head||document.getElementsByTagName("head")[0]),c=null,p=0,u=!1,h=function(){},l=null,d="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,s,r){u=s,l=r||{};var i=n(e,t);return v(i),function(t){for(var s=[],r=0;r<i.length;r++){var o=a[i[r].id];o.refs--,s.push(o)}t?v(i=n(e,t)):i=[];for(var r=0;r<s.length;r++){var o=s[r];if(0===o.refs){for(var c=0;c<o.parts.length;c++)o.parts[c]();delete a[o.id]}}}}function v(e){for(var t=0;t<e.length;t++){var s=e[t],n=a[s.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](s.parts[r]);for(;r<s.parts.length;r++)n.parts.push(w(s.parts[r]));n.parts.length>s.parts.length&&(n.parts.length=s.parts.length)}else{for(var i=[],r=0;r<s.parts.length;r++)i.push(w(s.parts[r]));a[s.id]={id:s.id,refs:1,parts:i}}}}function g(){var e=document.createElement("style");return e.type="text/css",o.appendChild(e),e}function w(e){var t,s,n=document.querySelector("style["+d+'~="'+e.id+'"]');if(n){if(u)return h;n.parentNode.removeChild(n)}if(f){var r=p++;t=b.bind(null,n=c||(c=g()),r,!1),s=b.bind(null,n,r,!0)}else t=C.bind(null,n=g()),s=function(){n.parentNode.removeChild(n)};return t(e),function(n){n?(n.css!==e.css||n.media!==e.media||n.sourceMap!==e.sourceMap)&&t(e=n):s()}}var x=(r=[],function(e,t){return r[e]=t,r.filter(Boolean).join("\n")});function b(e,t,s,n){var r=s?"":n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function C(e,t){var s=t.css,n=t.media,r=t.sourceMap;if(n&&e.setAttribute("media",n),l.ssrId&&e.setAttribute(d,t.id),r&&(s+="\n/*# sourceURL="+r.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}}}]);